<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
    <meta name="description" content="Weekly Pick 'em">
    <meta name="author" content="Eric Kurtzberg">
    <title>Weekly Pick 'em Login Page</title>
    <!--Import Google Icon Font and Custom Icons-->
	<link href="https://rawgit.com/Templarian/MaterialDesign-Webfont/master/css/materialdesignicons.min.css" media="all" rel="stylesheet" type="text/css">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css" media="screen,projection">
	<link rel="stylesheet" type="text/css" href="../css/main.css">
</head>

<body>
	<div id="header">
		<nav class="top-nav deep-orange darken-4">
			<a id="title" class="brand-logo center"></a>
			<a href="#!" data-activates="menu-nav" class="button-collapse show-on-large" style="transform: translateX(0px);"><i class="mdi mdi-menu mdi-48px"></i></a>
			<ul id="menu-nav" class="side-nav orange lighten-5">
				<li id="register-li">
					<a id="register-link" class="waves-effect"><i class="mdi mdi-pencil left"></i><b>Register</b></a>
				</li>
				<li id="login-li">
					<a id="login-logoff" class="waves-effect deep-orange lighten-3"><i class="mdi mdi-account left"></i><b>Login</b></a>
				</li>
			</ul>
		</nav>
	</div>
	
	<!--Import jQuery before materialize.js-->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
	<!--Firebase import-->
	<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
	<script type="text/javascript" src="../js/init.js"></script>
	<script type="text/javascript" src="../js/links.js"></script>
	<script>
		$(document).ready(function()
		{	
			$(".button-collapse").sideNav({
				menuWidth: 280, // Default is 240
				edge: 'left', // Choose the horizontal origin
			});
			$(".collapsible").collapsible({
				accordion : false // A setting that changes the collapsible behavior to expandable instead of the default accordion style
			});
			$("#title").text("Login");
			$("#password").bind('keypress', function(e)
			{
				if((e.keyCode || e.which) == 13)
					$("#login-button").trigger("click");
			});
			$("#main-content").on("click", "#login-button", function()
			{
				// replace button with loader animation
				$("#login-div").html('<div class="s12 m4 center">' +
					'<div class="preloader-wrapper big active">' +
					'<div class="spinner-layer spinner-blue-only">' +
					'<div class="circle-clipper left">' +
					'<div class="circle"></div>' +
					'</div><div class="gap-patch">' +
					'<div class="circle"></div>' + 
					'</div><div class="circle-clipper right">' +
					'<div class="circle"></div></div></div></div></div>');
				
				setTimeout(function()
				{ 
					firebase.auth().signInWithEmailAndPassword($('#email').val(), $('#password').val()).then(function(user)
					{
						if(user.emailVerified)
							window.location.href = "../standings";
						else
						{
							$("#email-not-confirmed").openModal({
								complete: function() { $("#login-li").trigger("click"); } // Callback for Modal close
							});
						}
					}, function(error)
					{
						Materialize.toast('Login Failed! Username and/or password is incorrect.', 6000, "red darken-1"); // 6000 is the duration  of the toast in milliseconds
						$('#login-div').html('<a id="login-button" class="btn waves-effect waves-light blue-grey lighten-1 col s2 offset-s5">Login</a>');
					});
				}, LOAD_DELAY);
			});
			$("#modal-resend-email").click(function()
			{
				firebase.auth().currentUser.sendEmailVerification();	// send confirmation email
				$("#modal-text").html("<h4>It's on its way!</h4><p>Verification email resent!</p>");
				$(".remove-me").remove();
			});
		});
	</script>
	
	<div id="main-content" class="container">
		<div id="login" style="padding-top:50px;">
			<div class="row">
				<div class="input-field col s6 push-s3"> 
					<i class="mdi mdi-account-circle prefix"></i>
					<input id="email" type="email"> 
					<label for="email">Email</label>
				</div>
			</div>
			<div class="row">
				<div class="input-field col s6 push-s3"> 
					<i class="mdi mdi-dots-horizontal prefix"></i>
					<input id="password" type="password"> 
					<label for="password">Password</label>
				</div>
			</div>
			<div class="row">
				<a href="forgot-password.html" class="col s6 push-s3 right-align">Forgot Password?</a>
			</div>
			<div class="row" id="login-div">
				<a id="login-button" class="btn waves-effect waves-light blue-grey lighten-1 btn-large col s4 push-s4">Login</a>
			</div>
		</div>
	</div>
	
	<!-- Modal Structure -->
	<div id="email-not-confirmed" class="modal">
		<div class="modal-content" id="modal-text">
			<h4>Account not confirmed!</h4>
			<p>Please check your email and use the link contained to confirm your account.</p>
		</div>
		<div class="modal-footer">
			<a href="#!" id="modal-dismiss" class="modal-action modal-close waves-effect waves-green btn-flat ">Okay</a>
			<a href="#!" id="modal-resend-email" class="modal-action waves-effect waves-green btn-flat remove-me">Resend Email</a>
		</div>
	</div>
	
	
</body>
</html>

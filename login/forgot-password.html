<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
    <meta name="description" content="Weekly Pick 'em">
    <meta name="author" content="Eric Kurtzberg">
    <title>Weekly Pick 'em Reset Password Page</title>
    <!--Import Google Icon Font and Custom Icons-->
	<link href="https://rawgit.com/Templarian/MaterialDesign-Webfont/master/css/materialdesignicons.min.css" media="all" rel="stylesheet" type="text/css">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css" media="screen,projection">
	<link rel="stylesheet" type="text/css" href="../css/main.css">
	<style>
		/* For mobile phones */
		.center-div {
			margin: 25% auto;
			max-width: 100%;
		}
		.right-inner {
			margin-left: auto;
			margin-right: 0;
			width: 150px;
		}
		.center-inner {
			margin: 0 4%;
			width: 100%;
		}
		.pad-me {
			margin-top: 10%;
		}
		@media only screen and (min-width: 801px) {
			.center-div {
				margin: 15% auto;
				max-width: 75%;
			}
			.pad-me {
				margin-top: 2%;
			}
		}
	</style>
</head>

<body>	
	<div id="header">
		<nav class="top-nav deep-orange darken-4">
			<a id="headerTitle" class="brand-logo center"></a>
			<a href="#!" data-activates="menu-nav" class="button-collapse show-on-large" style="transform: translateX(0px);"><i class="mdi mdi-menu mdi-48px"></i></a>
			<ul id="menu-nav" class="side-nav orange lighten-5">
				<li id="register-li">
					<a id="register-link" class="waves-effect"><i class="mdi mdi-pencil left"></i><b>Register</b></a>
				</li>
				<li id="login-li">
					<a id="login-logoff" class="waves-effect"><i class="mdi mdi-account left"></i><b>Login</b></a>
				</li>
			</ul>
		</nav>
	</div>
	
	<!--Import jQuery before materialize.js-->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
	<!--Firebase import-->
	<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
	<script type="text/javascript" src="../js/init.js"></script>
	<script type="text/javascript" src="../js/links.js"></script>
	<script>
		$(document).ready(function()
		{	
			$(".button-collapse").sideNav({
				menuWidth: 280, // Default is 240
				edge: 'left', // Choose the horizontal origin
			});
			$(".collapsible").collapsible({
				accordion : false // A setting that changes the collapsible behavior to expandable instead of the default accordion style
			});
			$("#headerTitle").text("Forgot Password");
			$("#email").bind('keypress', function(e)
			{
				if((e.keyCode || e.which) == 13)
					$("#reset-password-button").trigger("click");
			});
			$("#main-content").on("click", "#reset-password-button", function()
			{
				$('#reset-div').html('<div class="s12 m4 center">' +
					'<div class="preloader-wrapper big active">' +
					'<div class="spinner-layer spinner-blue-only">' +
					'<div class="circle-clipper left">' +
					'<div class="circle"></div>' +
					'</div><div class="gap-patch">' +
					'<div class="circle"></div>' + 
					'</div><div class="circle-clipper right">' +
					'<div class="circle"></div></div></div></div></div>');
				 
				setTimeout(function()
				{ 
					firebase.auth().sendPasswordResetEmail($('#email').val()).then(function()
					{
						$("#main-content").html("");
						$("#password-sent").openModal({
								complete: function() { $("#login-li").trigger("click"); } // Callback for Modal close
						});
					}, function(error)
					{
						Materialize.toast(error.message, 6000, "red darken-1"); // 4000 is the duration  of the toast in milliseconds
						$('#reset-div').html('<a id="reset-password-button" class="btn waves-effect waves-light blue-grey lighten-1 btn-large col s6 push-s3">Reset Password</a>');
					});
				}, LOAD_DELAY);
			});
		});
	</script>
	
	<div id="main-content" class="container">
		<div id="reset-password">
			<div class="center-div">
				<div class="input-field"> 
					<i class="mdi mdi-account-circle prefix"></i>
					<input id="email" type="email"> 
					<label for="email">Email</label>
				</div>
				<div class="center-inner">
					<p>
						Oh no! Forgot your password?<br/>
						Type in your email address, and an email will be sent to you with a reset password link.
					</p>
				</div>
				<div class="row pad-me" id="reset-div">
					<a id="reset-password-button" class="btn waves-effect waves-light blue-grey lighten-1 btn-large col s6 push-s3">Reset Password</a>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Modal Structure -->
	<div id="password-sent" class="modal">
		<div class="modal-content" id="modal-text">
			<h4>Email has been sent!</h4>
			<p>Check your inbox for an email containing a password reset link!</p>
			<p>Thanks!</p>
		</div>
		<div class="modal-footer">
			<a href="#!" id="modal-confirm" class="modal-action modal-close waves-effect waves-green btn-flat ">Back to Login</a>
		</div>
	</div>
	
	
</body>
</html>

<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<title>NFL Bootstrap Test</title>
		<!-- Latest compiled and minified CSS -->
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/css-toggle-switch/latest/toggle-switch.css" />
		<!-- Material Icons -->
		<link rel="stylesheet" type="text/css" href="http://cdn.materialdesignicons.com/1.7.22/css/materialdesignicons.min.css" />
		<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<link rel="stylesheet" type="text/css" href="css/picks.css">
	<body>
		<div id="main-content">
			<table class="table table-hover">
				<thead>
					<tr id="table-headers">
						<th data-field="rank">Rank</th>
						<th data-field="away">Away</th>
						<th data-field="pick">Pick</th>
						<th data-field="home">Home</th>
						<th data-field="date">Kickoff</th>
						<!-- <th data-field="reset">Reset Pick</th> -->
					</tr>
				</thead>
				<tbody id="games" class="ui-sortable"></tbody> 
			</table>
		</div>
		
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<!-- jQuery UI -->
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script type="text/javascript" src="../js/WeekGames.js"></script>
		<script>
			// document ready handler
			$(function () {
				var url = 'http://www.nfl.com/ajax/scorestrip?season=2016&seasonType=REG&week=12';
				// read from nfl.com all the games
				$.get(url, function(data) {
					// create weekly data object from XML file imported
					var weekData = new WeekGames(data, function () {
						for (var i=0; i<weekData.games.length; i++) {
							var away = weekData.games[i].awayTeam.abbrName;
							var home = weekData.games[i].homeTeam.abbrName;
							var id = weekData.games[i].id;
							$('<tr data-gameid="' + id + '"></tr>').appendTo('#games');
							$('<td class="rank">' + (weekData.games.length - i) + '</td>').appendTo('tr[data-gameid="' + id + '"]');
							$('<td class="away" id="away'+ i +'">' + weekData.games[i].awayTeam.fullName + '</td>').appendTo('tr[data-gameid="' + id + '"]');
							$('<td class="pick"><div class="switch-toggle well"></div></td>').appendTo('tr[data-gameid="' + id + '"]');
							$('<input type="radio" name="' + id + '" id="' + away + '" value="' + away + '">').appendTo($('div.well').eq(i));
							$('<label for="' + away + '"><div class="inner-center">' + away + '</div></label>').appendTo($('div.well').eq(i));
							$('<input class="pick" type="radio" name="' + id + '" id="pick' + i + '" value="-" checked="checked">').appendTo($('div.well').eq(i));
							$('<label class="pick" for="pick' + i + '">\n\
								<div class="inner-left"><i class="mdi mdi-arrow-left-bold" aria-hidden="true"></i></div>\n\
								<div class="inner-right"><i class="mdi mdi-arrow-right-bold" aria-hidden="true"></i></div>\n\
								<div class="inner-center">PICK</div></label>').appendTo($('div.well').eq(i));
							$('<input type="radio" name="' + id + '" id="' + home + '" value="' + home + '">').appendTo($('div.well').eq(i));
							$('<label for="' + home + '"><div class="inner-center">' + home + '</div></label>').appendTo($('div.well').eq(i));
							$('<a class="btn" id="btn-' + id + '"></a>').appendTo($('div.well').eq(i));
							$('<td class="home" id="home'+ i +'">' + weekData.games[i].homeTeam.fullName + '</td>').appendTo('tr[data-gameid="' + id + '"]');
							$('<td class="date">' + weekData.games[i].dateStringLong + '</td>').appendTo('tr[data-gameid="' + id + '"]');
							//$('<td class="reset"><i class="mdi mdi-close-circle"></i></td>').appendTo('tr[data-gameid="' + id + '"]');
							$('td').css('vertical-align', 'middle');
							$('#away' + i).css({'background-image': 'url(../team-logos/trans'+ away +'.png)'});
							$('#home' + i).css({'background-image': 'url(../team-logos/trans'+ home +'.png)'});
						}
						$('input:checked').each(function () {
							if($(this).val() === '-') {
								$('#btn-' + $(this).attr('name')).css('background-color', 'rgb(57, 85, 107)');
							}
						});
					});
				});
				
				//Helper function to keep table row from collapsing when being sorted
				var fixHelperModified = function (e, ui) {
					ui.children().each(function() {
						$(this).width($(this).width())
							.height($(this).height());
					});
					return ui;
				};
				
				//Make table sortable
				$('table tbody').sortable({
					start:	function (event, ui) {
						ui.placeholder.height(ui.item.outerHeight());
						var startPos = ui.item.index();
                        ui.item.data('startPos', startPos);
					},
					placeholder:	'placeholder',
					helper:	fixHelperModified,
					change:	function (event, ui) {
						var games = $('#games tr').length - 1;
						var startPos = ui.item.data('startPos');
						var index = ui.placeholder.index();
						var cIndex = (startPos < index)
							? index-2
							: index-1;
						ui.placeholder.prevAll('tr').each(function () {
							if ($(this).is(ui.item)) {
								return;
							}
							$(this).find('.rank').text(games - cIndex);
							cIndex--;
						});
                        
						cIndex = (startPos < index) ? index : index+1;
						ui.placeholder.nextAll('tr').each(function () {
							if ($(this).is(ui.item)) {
								return;
							}
							$(this).find('.rank').text(games - cIndex);
							cIndex++;
						});
						ui.item.find('.rank').text(games - ((startPos < index)
							? index-1
							: index));
                    },
					axis:		'y',
					opacity:	0.75
				});
			});
			
			$('#games').on('click', '.well', function () {
				$(this).find('.pick').remove();
				$(this).find('.btn').css('background-color', Team.getTeamColor($(this).find('input:checked').val()));
			});
			
			$('tbody').on('dblclick', 'tr', function () {
				var well = $(this).find('div.well');
				var id = well.find('input').attr('name');
				var i = $(this).parent().index($(this).parent());
				var html = well.html();
				var num = html.indexOf('</label>') + 8;
				var newHTML = '<input class="pick" type="radio" name="' + id + '" id="pick' + i + '" value="-" checked="checked">';
				newHTML += '<label class="pick" for="pick' + i + '">\n\
								<div class="inner-left"><i class="mdi mdi-arrow-left-bold" aria-hidden="true"></i></div>\n\
								<div class="inner-right"><i class="mdi mdi-arrow-right-bold" aria-hidden="true"></i></div>\n\
								<div class="inner-center">PICK</div></label>';
				html = html.slice(0, num) + newHTML + html.slice(num);
				well.html(html);
				well.find('.btn').css('background-color', 'rgb(57, 85, 107)');
				//well.find('label[class="pick"]').click();
			});
		</script>

	</body>
</html>
